import { config } from 'dotenv'
import { ApiRouteService } from '../lib/api-route-service'

// Charger les variables d'environnement
config({ path: '.env.local' })

const testComponents = async () => {
  console.log('ğŸ§ª Test des composants avec les nouveaux services...')
  console.log('ğŸ”‘ PAYLOAD_SECRET:', process.env['PAYLOAD_SECRET'] ? 'âœ… DÃ©fini' : 'âŒ Manquant')
  console.log('ğŸ—„ï¸ MONGODB_URI:', process.env['MONGODB_URI'] ? 'âœ… DÃ©fini' : 'âŒ Manquant')
  console.log('ğŸ­ NEXT_PUBLIC_USE_MOCK_DATA:', process.env['NEXT_PUBLIC_USE_MOCK_DATA'])

  try {
    // Test 1: Service des programmes
    console.log('\nğŸ“š Test des programmes...')
    const programmes = await ApiRouteService.getProgrammes()
    console.log(`   âœ… ${programmes.length} programmes rÃ©cupÃ©rÃ©s`)

    if (programmes.length > 0) {
      const programme = programmes[0]
      console.log(`   ğŸ“‹ Premier programme: ${programme?.titre ?? 'N/A'}`)
      console.log(`   ğŸ’° Prix: ${programme?.prix ?? 0}â‚¬`)
      console.log(`   ğŸ“Š Statut: ${programme?.statut ?? 'N/A'}`)
    }

    // Test 2: Service des apprenants
    console.log('\nğŸ‘¥ Test des apprenants...')
    const apprenants = await ApiRouteService.getApprenants()
    console.log(`   âœ… ${apprenants.length} apprenants rÃ©cupÃ©rÃ©s`)

    if (apprenants.length > 0) {
      const apprenant = apprenants[0]
      console.log(`   ğŸ“‹ Premier apprenant: ${apprenant?.nom ?? ''} ${apprenant?.prenom ?? ''}`)
      console.log(`   ğŸ“§ Email: ${apprenant?.email ?? 'N/A'}`)
      console.log(`   ğŸ“Š Progression: ${apprenant?.progression ?? 0}%`)
    }

    // Test 3: Service des utilisateurs
    console.log('\nğŸ‘¤ Test des utilisateurs...')
    const users = await ApiRouteService.getUsers()
    console.log(`   âœ… ${users.length} utilisateurs rÃ©cupÃ©rÃ©s`)

    if (users.length > 0) {
      const user = users[0]
      console.log(`   ğŸ“‹ Premier utilisateur: ${user?.name ?? 'N/A'}`)
      console.log(`   ğŸ“§ Email: ${user?.email ?? 'N/A'}`)
      console.log(`   ğŸ”‘ RÃ´le: ${user?.role ?? 'N/A'}`)
    }

    // Test 4: Service des rendez-vous
    console.log('\nğŸ“… Test des rendez-vous...')
    const rdvs = await ApiRouteService.getRendezVous()
    console.log(`   âœ… ${rdvs.length} rendez-vous rÃ©cupÃ©rÃ©s`)

    // Test 5: Service du blog
    console.log('\nğŸ“ Test du blog...')
    const articles = await ApiRouteService.getArticles()
    console.log(`   âœ… ${articles.length} articles rÃ©cupÃ©rÃ©s`)

    const categories = await ApiRouteService.getCategories()
    console.log(`   âœ… ${categories.length} catÃ©gories rÃ©cupÃ©rÃ©es`)

    const tags = await ApiRouteService.getTags()
    console.log(`   âœ… ${tags.length} tags rÃ©cupÃ©rÃ©s`)

    // Test 6: Statistiques
    console.log('\nğŸ“Š Test des statistiques...')
    const stats = await ApiRouteService.getStats()
    console.log('   ğŸ“Š Statistiques:')
    console.log(`     - Programmes: ${stats.programmes}`)
    console.log(`     - Apprenants: ${stats.apprenants}`)
    console.log(`     - Utilisateurs: ${stats.users}`)
    console.log(`     - Rendez-vous: ${stats.rdvs}`)
    console.log(`     - Articles: ${stats.articles}`)

    // Test 7: VÃ©rification du mode
    console.log('\nğŸ”„ VÃ©rification du mode...')
    const isMockMode = process.env['NEXT_PUBLIC_USE_MOCK_DATA'] === 'true'
    console.log(`   ğŸ­ Mode mock activÃ©: ${isMockMode}`)

    if (isMockMode) {
      console.log('   âœ… Utilisation des donnÃ©es mock')
    } else {
      console.log('   âœ… Utilisation des donnÃ©es MongoDB rÃ©elles')
    }

    console.log('\nğŸ‰ Tests des composants terminÃ©s!')
  } catch (error) {
    console.error('âŒ Erreur lors des tests des composants:', error)
  }
}

// ExÃ©cuter les tests
testComponents()
  .then(() => {
    console.log('\nâœ… Tests des composants terminÃ©s avec succÃ¨s!')
    process.exit(0)
  })
  .catch(error => {
    console.error('\nâŒ Erreur fatale lors des tests des composants:', error)
    process.exit(1)
  })
